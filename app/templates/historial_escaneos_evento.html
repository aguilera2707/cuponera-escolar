<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Historial de Escaneos - {{ evento.nombre_evento }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/historial_escaneo_evento.css') }}">

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
</head>
<body>
    <div class="admin-bg"></div>
    <div class="admin-contenedor">
        <h1>üìã Historial de escaneos ‚Äî {{ evento.nombre_evento }}</h1>

        <a href="{{ url_for('crear_qr_evento') }}" class="btn-volver">‚Üê Volver a eventos</a>
        <br><br>
        <a href="{{ url_for('exportar_historial_escaneos_evento', evento_id=evento.id) }}" class="btn btn-primary">
            üì• Exportar a Excel (CSV)
        </a>

        <br><br>
        <div class="table-responsive">
            <table id="tabla-historial" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th>ID Familia</th>
                        <th>Nombre Familia</th>
                        <th>Fecha de escaneo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in registros %}
                        <tr>
                            <td>{{ r.familia_id }}</td>
                            <td>{{ r.familia.nombre if r.familia else '-' }}</td>
                            <td>{{ r.fecha.strftime('%Y-%m-%d %H:%M') }}</td>
                        </tr>
                    {% else %}
                        <tr><td colspan="3">No hay registros de escaneo.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- jQuery y DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script>
        // B√∫squeda que ignora acentos y may√∫sculas
        jQuery.fn.DataTable.ext.type.search.string = function(data) {
            return !data ? '' :
                typeof data === 'string' ?
                    data.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase() :
                    data;
        };

        $(document).ready(function () {
            $('#tabla-historial').DataTable({
                language: {
                    search: "üîç Buscar:",
                    lengthMenu: "Mostrar _MENU_ registros",
                    info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
                    paginate: {
                        previous: "‚Üê",
                        next: "‚Üí"
                    },
                    zeroRecords: "No se encontraron coincidencias",
                },
                pageLength: 10,
                lengthMenu: [5, 10, 20, 50, 100]
            });
        });
    </script>
</body>
</html>
